<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Banana Empire</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&family=Playfair+Display:wght@700&display=swap" rel="stylesheet" />
  <style>
    /* Global Styles */
    * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
    body { font-family: 'Montserrat', sans-serif; overflow: hidden; color: #333; }
    h1, h2 { font-family: 'Playfair Display', serif; }
    
    /* News Reel */
    #newsReel {
      position: fixed; top: 0; width: 100%; height: 30px; background: #000; color: #fff;
      overflow: hidden; z-index: 110; font-size: 16px; line-height: 30px;
    }
    #newsContent {
      display: inline-block;
      white-space: nowrap;
      animation: scrollNews 15s linear infinite;
    }
    @keyframes scrollNews {
      from { transform: translateX(100%); }
      to { transform: translateX(-100%); }
    }
    
    /* Menu Styles */
    #startMenu, #storyMenu, #pauseMenu, #bossFight {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      display: flex; justify-content: center; align-items: center;
    }
    #startMenu, #storyMenu {
      background: rgba(0, 0, 0, 0.85); color: #fff; flex-direction: column; text-align: center; z-index: 1000;
    }
    #pauseMenu {
      background: rgba(0, 0, 0, 0.7); flex-direction: column; z-index: 1000; display: none;
      color: #fff;
    }
    #bossFight { background: rgba(0, 0, 0, 0.9); z-index: 2000; display: none; }
    #startMenu h1, #storyMenu h1 { font-size: 60px; margin-bottom: 20px; text-shadow: 2px 2px 5px #000; }
    #startMenu button, #storyMenu button, #pauseMenu button {
      padding: 15px 30px; font-size: 24px; border: none; border-radius: 10px; cursor: pointer; font-weight: 600;
      background: #FFC107; color: #000; margin: 10px; transition: background 0.3s ease;
    }
    #startMenu button:hover, #storyMenu button:hover, #pauseMenu button:hover { background: #FFB300; }
    #pauseMenu h1 { font-size: 50px; margin-bottom: 30px; text-shadow: 2px 2px 5px #000; }
    
    /* Game Container & Background */
    #gameContainer {
      position: relative; width: 100%; height: 100vh;
      background: url('https://i.postimg.cc/NFKqstFM/DALL-E-2025-02-25-12-07-48-A-highly-detailed-ultra-realistic-jungle-scene-resembling-the-African.png') no-repeat center center;
      background-size: cover; overflow: hidden;
      padding-top: 30px; /* for news reel */
    }
    #scoreBoard {
      position: absolute; top: 40px; left: 10px; background: rgba(255, 255, 255, 0.95); padding: 10px 20px;
      border-radius: 8px; font-size: 24px; z-index: 500; box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3);
    }
    /* Main Banana Tree */
    #bananaTree {
      position: absolute; bottom: 50px; left: 50%; transform: translateX(-50%);
      width: 500px; height: 500px;
      background: url('https://static.vecteezy.com/system/resources/thumbnails/021/515/254/small_2x/green-banana-tree-on-transparent-background-file-png.png') no-repeat center bottom;
      background-size: contain; cursor: pointer;
    }
    /* Monkey Assistants */
    #monkeyDisplay { position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%); display: flex; align-items: center; z-index: 550; }
    /* Prompt Display */
    #promptDisplay {
      position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.7); color: #fff; padding: 10px 20px; border-radius: 8px;
      font-size: 20px; display: none; z-index: 700;
    }
    /* Day/Night Overlay */
    #dayNightOverlay {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none;
      background: #000; opacity: 0; transition: opacity 1s;
      z-index: 800;
    }
    /* Rain Effects */
    #rainContainer {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 900;
    }
    .raindrop {
      position: absolute; width: 5px; height: 5px; background: blue; border-radius: 50%;
      animation: fall 2s linear;
      opacity: 0.7;
    }
    @keyframes fall {
      from { transform: translateY(-10px); }
      to { transform: translateY(110vh); }
    }
    
    /* Banana Animation (Floating Banana) */
    .bananaAnimation {
      position: absolute; width: 100px; height: 100px;
      background: url('https://i.imgur.com/Mudezu4.png') no-repeat center center;
      background-size: contain;
      animation: floatUp 1s ease-out forwards;
      pointer-events: none;
      z-index: 600;
    }
    @keyframes floatUp {
      0% { opacity: 1; transform: translate(0, 0) scale(1); }
      100% { opacity: 0; transform: translate(var(--dx), var(--dy)) scale(1.5); }
    }
    
    /* Draggable Windows */
    .draggable {
      position: absolute; background: rgba(255, 255, 255, 0.95); border-radius: 8px;
      box-shadow: 2px 2px 10px rgba(0, 0, 0, 0.3); z-index: 500; width: 300px;
    }
    .window-header {
      background: #FFC107; padding: 10px; cursor: move;
      border-top-left-radius: 8px; border-top-right-radius: 8px;
      font-weight: 600; display: flex; justify-content: space-between; align-items: center;
    }
    .window-content { padding: 10px; }
    .close-btn { cursor: pointer; font-weight: bold; }
    .collapsed { height: 20px; overflow: hidden; }
    .collapsed .window-content { display: none; }
    .reopen-btn {
      position: absolute; bottom: 0; left: 0; right: 0; height: 20px;
      background: #FFC107; text-align: center; line-height: 20px; cursor: pointer; display: none;
    }
    .draggable.collapsed .reopen-btn { display: block; }
    
    /* Planted Trees (transparent and clickable) */
    .plantedTree {
      position: absolute;
      width: 500px;
      height: 500px;
      background: url('https://static.vecteezy.com/system/resources/thumbnails/021/515/254/small_2x/green-banana-tree-on-transparent-background-file-png.png') no-repeat center bottom;
      background-size: contain;
      opacity: 1;
      cursor: pointer;
      z-index: 400;
    }
    /* Planting Message */
    #plantingMessage {
      position: absolute; top: 100px; left: 50%; transform: translateX(-50%);
      background: rgba(0,0,0,0.7); color: #fff; padding: 10px; border-radius: 8px;
      display: none; z-index: 1100;
    }
    
    /* Monkey Characters Panel */
    #monkeyCharactersPanel {
      position: fixed;
      bottom: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 10px;
      z-index: 1100;
    }
    #monkeyCharactersPanel img {
      width: 80px;
      height: 80px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid #FFC107;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      #scoreBoard { font-size: 20px; }
      #startMenu h1, #storyMenu h1 { font-size: 40px; }
      #pauseMenu h1 { font-size: 35px; }
      .draggable { width: 90%; }
    }
  </style>
</head>
<body>
  <!-- Background Music -->
  <audio id="backgroundMusic" loop>
    <source src="placeholder.mp3" type="audio/mp3">
  </audio>

  <!-- News Reel -->
  <div id="newsReel">
    <div id="newsContent"></div>
  </div>

  <!-- Start Menu -->
  <div id="startMenu">
    <h1>Banana Empire</h1>
    <button id="startButton">Start Game</button>
    <button id="storyModeButton">Story Mode</button>
  </div>

  <!-- Story Mode Menu -->
  <div id="storyMenu" style="display: none; flex-direction: column;">
    <div id="storyContainer" style="max-width: 800px; padding: 20px; background: rgba(34,34,34,0.95); border-radius: 8px; box-shadow: 2px 2px 10px rgba(0,0,0,0.3); color: #fff; text-align: center;"></div>
    <div style="margin-top:20px;">
      <button id="storyNextButton">Next</button>
      <button id="backToMainMenu">Back</button>
    </div>
  </div>

  <!-- Pause Menu -->
  <div id="pauseMenu">
    <h1>Paused</h1>
    <button id="resumeButton">Resume Game</button>
    <button id="mainMenuButton">Main Menu</button>
  </div>

  <!-- Boss Fight Overlay -->
  <div id="bossFight">
    <div id="bossContent" style="text-align: center; color: #fff;">
      <img id="bossImage" src="https://i.postimg.cc/brcWht76/DALL-E-2025-02-25-12-21-01-A-highly-detailed-ultra-realistic-depiction-of-the-Monkey-King-as-see.png" alt="Monkey King" style="width: 400px;">
      <div id="bossHealthDisplay" style="font-size: 32px; margin-top: 20px;">Health: 30</div>
    </div>
  </div>

  <!-- Game Container -->
  <div id="gameContainer">
    <div id="scoreBoard">
      Bananas: <span id="bananaCount">0</span> | Click Value: <span id="clickValueDisplay">1</span> | Day: <span id="dayDisplay">1</span>
    </div>
    <div id="dayNightOverlay"></div>
    <div id="rainContainer"></div>
    <div id="bananaTree"></div>
    <div id="monkeyDisplay"></div>
    <div id="promptDisplay"></div>
    <!-- Planting Message -->
    <div id="plantingMessage">Tree is getting planted!</div>

    <!-- Draggable Upgrades Panel -->
    <div id="upgradesPanel" class="draggable" style="top: 80px; left: 20px;">
      <div class="window-header">
        Upgrades <span class="close-btn" data-target="upgradesPanel">×</span>
      </div>
      <div class="window-content" id="upgradesList"></div>
      <div class="reopen-btn" data-target="upgradesPanel">Upgrades</div>
    </div>

    <!-- Draggable Harvesting Upgrades Panel -->
    <div id="harvestingUpgradesPanel" class="draggable" style="top: 80px; right: 20px;">
      <div class="window-header">
        Harvesting Upgrades <span class="close-btn" data-target="harvestingUpgradesPanel">×</span>
      </div>
      <div class="window-content" id="clickUpgradesList"></div>
      <div class="reopen-btn" data-target="harvestingUpgradesPanel">Harvesting</div>
    </div>
    
    <!-- Monkey Characters Panel (hidden until empire grows) -->
    <div id="monkeyCharactersPanel" style="display: none;"></div>
  </div>

  <script>
    /*==============================
      Game State & Variables
    ==============================*/
    let bananaCount = 0, autoProduction = 0, clickValue = 1, gamePaused = false, storyModeActive = false, costMultiplier = 1.3;
    let bossFightActive = false, bossHealth = 30, bossFightTimer;
    let isRaining = false, rainProductionMultiplier = 0.5;
    let dayTimer = 0, daysPassed = 0;
    const dayLength = 180; // seconds per day
    const dayPhaseDuration = 120; // first 120 sec = day; remaining = night
    let isNight = false;
    let monkeyCharactersDisplayed = false;
    
    const upgrades = [
      { id: 1, name: 'Banana Tree', baseCost: 20, cost: 20, production: 1, quantity: 0 },
      { id: 2, name: 'Monkey Assistant', baseCost: 100, cost: 100, production: 5, quantity: 0 },
      { id: 3, name: 'Banana Plantation', baseCost: 400, cost: 400, production: 20, quantity: 0 },
      { id: 4, name: 'Monkey Farm', baseCost: 2000, cost: 2000, production: 100, quantity: 0 },
      { id: 5, name: 'Banana Shipping', baseCost: 10000, cost: 10000, production: 500, quantity: 0 },
      { id: 6, name: 'Monkey Laboratory', baseCost: 40000, cost: 40000, production: 2000, quantity: 0 },
      { id: 7, name: 'Banana Bank', baseCost: 200000, cost: 200000, production: 10000, quantity: 0 },
      { id: 8, name: 'Monkey Convention', baseCost: 1000000, cost: 1000000, production: 50000, quantity: 0 },
      { id: 9, name: 'Banana Empire', baseCost: 4000000, cost: 4000000, production: 200000, quantity: 0 },
      { id: 10, name: 'Monkey King', baseCost: 20000000, cost: 20000000, production: 1000000, quantity: 0 }
    ];
    const clickUpgrades = [
      { id: 1, name: 'Click Booster', baseCost: 30, cost: 30, bonus: 1, quantity: 0 },
      { id: 2, name: 'Golden Glove', baseCost: 200, cost: 200, bonus: 3, quantity: 0 },
      { id: 3, name: 'Turbo Fingers', baseCost: 1000, cost: 1000, bonus: 5, quantity: 0 },
      { id: 4, name: 'Banana Handshake', baseCost: 5000, cost: 5000, bonus: 10, quantity: 0 },
      { id: 5, name: 'Hyper Clicker', baseCost: 20000, cost: 20000, bonus: 25, quantity: 0 }
    ];
    const storyPrompts = [
      { condition: () => upgrades[1].quantity >= 1, message: "A lone monkey shows interest.", triggered: false },
      { condition: () => upgrades[1].quantity >= 2, message: "More monkeys are gathering around you.", triggered: false },
      { condition: () => upgrades[1].quantity >= 3, message: "The monkeys seem curious about your power.", triggered: false },
      { condition: () => upgrades[1].quantity >= 4, message: "The monkeys are starting to chatter excitedly.", triggered: false },
      { condition: () => upgrades[1].quantity >= 5, message: "The monkeys like you a lot!", triggered: false },
      { condition: () => upgrades[1].quantity >= 6, message: "The monkey crowd grows stronger.", triggered: false },
      { condition: () => upgrades[1].quantity >= 7, message: "A small monkey parade marches by.", triggered: false },
      { condition: () => upgrades[1].quantity >= 8, message: "Monkeys are playing in your honor.", triggered: false },
      { condition: () => upgrades[1].quantity >= 9, message: "The jungle resounds with monkey cheers.", triggered: false },
      { condition: () => upgrades[1].quantity >= 10, message: "A monkey king nods in approval.", triggered: false },
      { condition: () => bananaCount >= 100, message: "Your banana harvest is growing steadily.", triggered: false },
      { condition: () => bananaCount >= 250, message: "Bananas overflow as your empire expands.", triggered: false },
      { condition: () => bananaCount >= 500, message: "The jungle whispers of your bounty.", triggered: false },
      { condition: () => bananaCount >= 750, message: "Golden bananas glisten in the sun.", triggered: false },
      { condition: () => bananaCount >= 1000, message: "A banana bonanza shakes the forest.", triggered: false },
      { condition: () => clickValue >= 5, message: "Your nimble fingers work like magic.", triggered: false },
      { condition: () => clickValue >= 10, message: "Every click now yields a cascade of bananas.", triggered: false },
      { condition: () => autoProduction >= 50, message: "Machines of monkey labor are at work.", triggered: false },
      { condition: () => autoProduction >= 100, message: "Your production towers over the jungle.", triggered: false },
      { condition: () => autoProduction >= 250, message: "Even the trees seem to bend to your will.", triggered: false },
      { condition: () => upgrades[0].quantity >= 5, message: "Your banana trees flourish with vitality.", triggered: false },
      { condition: () => upgrades[2].quantity >= 3, message: "Plantations spread like a golden sea.", triggered: false },
      { condition: () => upgrades[3].quantity >= 2, message: "Monkey farms hum with activity.", triggered: false },
      { condition: () => upgrades[4].quantity >= 1, message: "Banana shipping lines deliver riches.", triggered: false },
      { condition: () => upgrades[5].quantity >= 1, message: "The laboratories churn out scientific marvels.", triggered: false },
      { condition: () => upgrades[6].quantity >= 1, message: "Banks of bananas boost your economy.", triggered: false },
      { condition: () => upgrades[7].quantity >= 1, message: "Conventions celebrate your visionary style.", triggered: false },
      { condition: () => upgrades[8].quantity >= 1, message: "An empire of bananas is in the making.", triggered: false },
      { condition: () => upgrades[9].quantity >= 1, message: "The Monkey King bestows his regal favor.", triggered: false },
      { condition: () => bananaCount >= 10000, message: "The jungle roars with the power of your harvest.", triggered: false }
    ];
    
    // Define monkey business characters (funny names, placeholder images, and dialogues)
    const monkeyCharacters = [
      {
        name: "Cheeky Charlie",
        image: "https://via.placeholder.com/100?text=Cheeky+Charlie",
        dialogues: [
          "Hey, want a banana discount?",
          "I sell bananas at the best price in town!",
          "Bananas? More like bonanas, am I right?"
        ]
      },
      {
        name: "Banana Bob",
        image: "https://via.placeholder.com/100?text=Banana+Bob",
        dialogues: [
          "Ever seen a banana flip? Watch this!",
          "My banana jokes will peel you away!",
          "I'm the top banana in this empire!"
        ]
      },
      {
        name: "Funky Frank",
        image: "https://via.placeholder.com/100?text=Funky+Frank",
        dialogues: [
          "Let's boogie and trade some bananas!",
          "Funky beats and bananas, that's the deal!",
          "Your bananas never looked so funky!"
        ]
      },
      {
        name: "Jungle Joe",
        image: "https://via.placeholder.com/100?text=Jungle+Joe",
        dialogues: [
          "In the jungle, the mighty banana roars!",
          "Trade bananas with me and rule the jungle!",
          "Bananas are the currency of the wild!"
        ]
      },
      {
        name: "Silly Sam",
        image: "https://via.placeholder.com/100?text=Silly+Sam",
        dialogues: [
          "Did you hear the one about the banana and the monkey?",
          "Silly bananas, silly monkeys, it's all a laugh!",
          "Come on, join my banana circus!"
        ]
      }
    ];
    const newsDialogues = [
      "Breaking: Monkeys protest over stale bananas!",
      "Banana prices skyrocket as trees start whispering secrets.",
      "Jungle in uproar: Rain delays banana shipments.",
      "Local monkey spotted leading a banana parade.",
      "Scientists baffled by banana flavor changes overnight.",
      "Rain or shine, bananas still taste divine.",
      "Monkey stock market crashes after banana overproduction.",
      "Incredible: Banana empire expands to new treetops.",
      "Weather alert: Sudden rain dampens monkey spirits.",
      "Exclusive: Banana workers demand extra coconut breaks.",
      "Breaking: Jungle news confirms: bananas are alive!",
      "Monkey union strikes over extra slippery peels.",
      "Mystery solved: Bananas are secretly powering the jungle.",
      "Alert: Tropical storm predicted – bananas brace for impact.",
      "Bizarre: Monkeys adopt a new dance after harvest.",
      "Rumor: The Monkey King is planning a banana festival.",
      "Jungle gossip: Banana banks now offer interest in peels.",
      "Alert: Rainfall expected to double banana discounts.",
      "Monkeys rejoice as the banana harvest hits record highs.",
      "Update: Banana shipments delayed by mysterious fog.",
      "Exclusive: New banana flavor takes the jungle by storm.",
      "Breaking: Monkey workers celebrate a surprise holiday.",
      "Jungle news: Local vines vote to become banana trees.",
      "Rumor: The jungle's bananas are organizing a talent show.",
      "Alert: Banana production takes a hit as monkeys nap.",
      "Monkeys debate: Is the banana king really a king?",
      "Update: Rainy days slow down the banana frenzy.",
      "Breaking: Banana workers form a union for extra breaks.",
      "Jungle update: Monkeys claim they’ve discovered golden bananas.",
      "Exclusive: Banana harvest expected to be extra juicy today."
    ];

    /*==============================
      Save & Load Game State
    ==============================*/
    function saveGameState() {
      localStorage.setItem('bananaCount', bananaCount);
      localStorage.setItem('clickValue', clickValue);
    }
    function loadGameState() {
      bananaCount = parseInt(localStorage.getItem('bananaCount')) || 0;
      clickValue = parseInt(localStorage.getItem('clickValue')) || 1;
    }
    window.addEventListener('load', loadGameState);

    /*==============================
      Upgrade Panel Initialization
    ==============================*/
    function initUpgrades() {
      const upgradesList = document.getElementById('upgradesList');
      upgradesList.innerHTML = '';
      upgrades.forEach((upgrade, index) => {
        let div = document.createElement('div');
        div.style.padding = '5px';
        div.style.borderBottom = '1px solid #ccc';
        div.innerHTML = `<strong>${upgrade.name}</strong><br>
                         Cost: <span class="upgradeCost">${upgrade.cost}</span><br>
                         Owned: <span class="upgradeQuantity">${upgrade.quantity}</span><br>
                         Production: ${upgrade.production} bananas/sec`;
        div.addEventListener('click', (e) => {
          e.currentTarget.classList.add('click-animate');
          setTimeout(() => { e.currentTarget.classList.remove('click-animate'); }, 200);
          purchaseUpgrade(index);
        });
        upgradesList.appendChild(div);
      });
    }
    function initClickUpgrades() {
      const clickUpgradesList = document.getElementById('clickUpgradesList');
      clickUpgradesList.innerHTML = '';
      clickUpgrades.forEach((upgrade, index) => {
        let div = document.createElement('div');
        div.style.padding = '5px';
        div.style.borderBottom = '1px solid #ccc';
        div.innerHTML = `<strong>${upgrade.name}</strong><br>
                         Cost: <span class="upgradeCost">${upgrade.cost}</span><br>
                         Owned: <span class="upgradeQuantity">${upgrade.quantity}</span><br>
                         Click Bonus: +${upgrade.bonus}`;
        div.addEventListener('click', (e) => {
          e.currentTarget.classList.add('click-animate');
          setTimeout(() => { e.currentTarget.classList.remove('click-animate'); }, 200);
          purchaseClickUpgrade(index);
        });
        clickUpgradesList.appendChild(div);
      });
    }

    /*==============================
      Purchase & Display Functions
    ==============================*/
    function purchaseUpgrade(index) {
      let upgrade = upgrades[index];
      if(bananaCount >= upgrade.cost) {
        bananaCount -= upgrade.cost;
        upgrade.quantity++;
        autoProduction += upgrade.production;
        upgrade.cost = Math.floor(upgrade.baseCost * Math.pow(costMultiplier, upgrade.quantity));
        updateDisplay();
        initUpgrades();
        if(upgrade.id === 1) {
          plantBananaTreeDelayed();
        }
        if(upgrade.id === 10 && upgrade.quantity === 1) triggerBossFight();
      }
    }
    function purchaseClickUpgrade(index) {
      let upgrade = clickUpgrades[index];
      if(bananaCount >= upgrade.cost) {
        bananaCount -= upgrade.cost;
        upgrade.quantity++;
        clickValue += upgrade.bonus;
        upgrade.cost = Math.floor(upgrade.baseCost * Math.pow(costMultiplier, upgrade.quantity));
        updateDisplay();
        initClickUpgrades();
      }
    }
    function updateDisplay() {
      document.getElementById('bananaCount').textContent = Math.floor(bananaCount);
      document.getElementById('clickValueDisplay').textContent = clickValue;
      document.getElementById('dayDisplay').textContent = daysPassed + 1;
      updateMonkeyDisplay();
      checkPrompts();
      saveGameState();
      updateMonkeyCharacters(); // update empire characters when needed
    }
    function updateMonkeyDisplay() {
      const monkeyDisplay = document.getElementById('monkeyDisplay');
      if(isRaining || isNight) { monkeyDisplay.innerHTML = ""; return; }
      monkeyDisplay.innerHTML = "";
      for(let i = 0; i < upgrades[1].quantity; i++) {
        let img = document.createElement('img');
        img.src = "https://i.pinimg.com/474x/da/0f/17/da0f17568351694b550182d8caac5c00.jpg";
        img.style.width = "50px"; img.style.height = "50px"; 
        img.style.borderRadius = "50%"; img.style.border = "2px solid #fff";
        if(i > 0) img.style.marginLeft = "-15px";
        monkeyDisplay.appendChild(img);
      }
    }
    
    /*==============================
      New Banana Tree Planting Functions
    ==============================*/
    let pendingTreePlantings = 0;
    function plantBananaTreeDelayed() {
      pendingTreePlantings++;
      updatePlantingMessage();
      const msgEl = document.getElementById('plantingMessage');
      if(msgEl.style.display === 'none' || msgEl.style.display === '') {
        msgEl.style.display = 'block';
        msgEl.style.opacity = 1;
      }
      setTimeout(() => {
        spawnPlantedTree();
        pendingTreePlantings--;
        updatePlantingMessage();
        if(pendingTreePlantings <= 0) {
          fadeOutPlantingMessage();
        }
      }, 10000);
    }
    function updatePlantingMessage() {
      const msgEl = document.getElementById('plantingMessage');
      msgEl.textContent = pendingTreePlantings > 1 ? "Trees are getting planted!" : "Tree is getting planted!";
    }
    function fadeOutPlantingMessage() {
      const msgEl = document.getElementById('plantingMessage');
      msgEl.style.transition = 'opacity 2s';
      msgEl.style.opacity = 0;
      setTimeout(() => { msgEl.style.display = 'none'; }, 2000);
    }
    function spawnPlantedTree() {
      let tree = document.createElement('div');
      tree.className = 'plantedTree';
      const container = document.getElementById('gameContainer');
      const containerRect = container.getBoundingClientRect();
      let maxLeft = containerRect.width - 500;
      let maxTop = containerRect.height - 500;
      let randomLeft = Math.random() * maxLeft;
      let randomTop = Math.random() * maxTop;
      tree.style.left = randomLeft + 'px';
      tree.style.top = randomTop + 'px';
      tree.addEventListener('click', function(e) {
        if(!gamePaused && !bossFightActive) {
          tree.classList.add('click-animate');
          setTimeout(() => { tree.classList.remove('click-animate'); }, 200);
          bananaCount += clickValue;
          updateDisplay();
          animateBananaHarvest(e);
        }
      });
      container.appendChild(tree);
    }
    function animateBananaHarvest(event) {
      let targetRect;
      if(event && event.currentTarget && event.currentTarget.classList.contains('plantedTree')) {
        targetRect = event.currentTarget.getBoundingClientRect();
      } else {
        targetRect = document.getElementById('bananaTree').getBoundingClientRect();
      }
      let originX = event ? event.clientX - 50 : targetRect.left + targetRect.width / 2 - 50;
      let originY = event ? event.clientY - 50 : targetRect.top + targetRect.height / 2 - 50;
      let banana = document.createElement('div');
      banana.className = 'bananaAnimation';
      banana.style.left = originX + 'px';
      banana.style.top = originY + 'px';
      let dx = Math.floor(Math.random() * 200 - 100);
      let dy = Math.floor(Math.random() * -150 - 50);
      banana.style.setProperty('--dx', dx + 'px');
      banana.style.setProperty('--dy', dy + 'px');
      document.getElementById('gameContainer').appendChild(banana);
      setTimeout(() => { banana.remove(); }, 1000);
    }
    
    function animateMonkeyAssistants() {
      if(isRaining || isNight) return;
      const monkeyDisplay = document.getElementById('monkeyDisplay');
      Array.from(monkeyDisplay.children).forEach(img => {
        let rect = img.getBoundingClientRect();
        let banana = document.createElement('div');
        banana.className = 'bananaAnimation';
        banana.style.width = "50px"; banana.style.height = "50px";
        banana.style.left = rect.left + "px"; banana.style.top = rect.top + "px";
        let dx = Math.floor(Math.random() * 50 - 25), dy = Math.floor(Math.random() * -50 - 25);
        banana.style.setProperty('--dx', dx + 'px');
        banana.style.setProperty('--dy', dy + 'px');
        document.getElementById('gameContainer').appendChild(banana);
        setTimeout(() => { banana.remove(); }, 1000);
      });
    }
    
    /*==============================
      Boss Fight Functions
    ==============================*/
    function triggerBossFight() {
      bossFightActive = true;
      bossHealth = 100;
      document.getElementById('bossHealthDisplay').textContent = "Health: " + bossHealth;
      document.getElementById('gameContainer').style.display = 'none';
      document.getElementById('bossFight').style.display = 'flex';
      bossFightTimer = setTimeout(() => { if(bossFightActive) endBossFight(false); }, 10000);
    }
    function handleBossClick() {
      if(!bossFightActive) return;
      bossHealth--;
      document.getElementById('bossHealthDisplay').textContent = "Health: " + bossHealth;
      if(bossHealth <= 0) endBossFight(true);
    }
    function endBossFight(success) {
      bossFightActive = false;
      clearTimeout(bossFightTimer);
      document.getElementById('bossFight').style.display = 'none';
      document.getElementById('gameContainer').style.display = 'block';
      displayPrompt(success ? "You defeated the Monkey King! He is now your slave and produces bananas for you!" : "You failed to defeat the Monkey King.");
    }
    document.getElementById('bossFight').addEventListener('click', handleBossClick);

    /*==============================
      Game Interactions & Intervals
    ==============================*/
    const mainTree = document.getElementById('bananaTree');
    mainTree.addEventListener('click', function(e) {
      if(!gamePaused && !bossFightActive) {
        mainTree.classList.add('click-animate');
        setTimeout(() => { mainTree.classList.remove('click-animate'); }, 200);
        bananaCount += clickValue;
        updateDisplay();
        animateBananaHarvest(e);
      }
    });
    setInterval(function() {
      if(!gamePaused && !bossFightActive) {
        let productionMultiplier = 1;
        if(isNight) productionMultiplier *= 0.5;
        if(isRaining) productionMultiplier *= rainProductionMultiplier;
        bananaCount += autoProduction * productionMultiplier;
        updateDisplay();
      }
    }, 1000);

    /*==============================
      Day/Night Cycle
    ==============================*/
    function updateDayNightCycle() {
      dayTimer++;
      if(dayTimer >= dayLength) { daysPassed++; dayTimer = 0; }
      isNight = dayTimer >= dayPhaseDuration;
      document.getElementById('dayNightOverlay').style.opacity = isNight ? 0.5 : 0;
      updateDisplay();
    }
    setInterval(updateDayNightCycle, 1000);

    /*==============================
      Rain Event
    ==============================*/
    function spawnRaindrop() {
      let drop = document.createElement('div');
      drop.className = 'raindrop';
      drop.style.left = Math.random() * window.innerWidth + 'px';
      drop.style.top = '-10px';
      document.getElementById('rainContainer').appendChild(drop);
      setTimeout(() => { drop.remove(); }, 2000);
    }
    function startRain() {
      isRaining = true;
      rainInterval = setInterval(spawnRaindrop, 300);
      setTimeout(endRain, 15000);
    }
    function endRain() {
      isRaining = false;
      clearInterval(rainInterval);
    }
    function checkRainChance() {
      if(Math.random() < 0.2 && !isRaining) startRain();
    }
    setInterval(checkRainChance, 30000);

    /*==============================
      News Reel
    ==============================*/
    let newsIndex = 0;
    function updateNewsReel() {
      const newsContent = document.getElementById('newsContent');
      newsContent.innerText = newsDialogues[newsIndex];
      newsIndex = (newsIndex + 1) % newsDialogues.length;
    }
    updateNewsReel();
    setInterval(updateNewsReel, 15000);

    /*==============================
      Monkey Characters (Empire Business)
    ==============================*/
    function updateMonkeyCharacters() {
      // Show characters once bananaCount reaches 5000 (if not already displayed)
      if(bananaCount >= 5000 && !monkeyCharactersDisplayed) {
        const panel = document.getElementById('monkeyCharactersPanel');
        panel.style.display = 'flex';
        monkeyCharacters.forEach(monkey => {
          let img = document.createElement('img');
          img.src = monkey.image;
          img.title = monkey.name;
          img.addEventListener('click', () => {
            const dialogue = monkey.dialogues[Math.floor(Math.random() * monkey.dialogues.length)];
            displayPrompt(`${monkey.name}: ${dialogue}`);
          });
          panel.appendChild(img);
        });
        monkeyCharactersDisplayed = true;
      }
    }
    
    /*==============================
      Story Mode & Menu Interactions
    ==============================*/
    const storyPages = [
      { text: `<h1>Rise of the Bananas</h1><p>In the heart of a mysterious jungle, legends speak of a power hidden within the golden fruit. You are destined to harness this power.</p>` },
      { text: `<p>The monkeys, guardians of the ancient groves, have long awaited a champion who can unite their strength with the magic of the bananas.</p>` },
      { text: `<p>Before you embark on your quest, choose your destiny:</p>
                <button onclick="choosePath('swift')">The Path of the Swift</button>
                <button onclick="choosePath('mighty')">The Path of the Mighty</button>` },
      { text: `<p>Your decision has been made. The jungle awakens as you prepare to harvest the power of the bananas.</p>
                <button id="beginHarvestButton">Begin Your Harvest</button>` }
    ];
    let currentStoryPage = 0;
    function displayStoryPage() {
      const container = document.getElementById('storyContainer');
      container.innerHTML = storyPages[currentStoryPage].text;
      if(currentStoryPage === storyPages.length - 1) {
        document.getElementById('beginHarvestButton').addEventListener('click', function() {
          document.getElementById('storyMenu').style.display = 'none';
          startGame();
        });
      }
    }
    function choosePath(path) {
      if(path === 'swift') { costMultiplier = 1.4; clickValue += 2; }
      else if(path === 'mighty') { costMultiplier = 1.6; autoProduction += 10; }
      currentStoryPage++;
      displayStoryPage();
    }
    document.getElementById('storyNextButton').addEventListener('click', function() {
      if(currentStoryPage < storyPages.length - 1) { currentStoryPage++; displayStoryPage(); }
    });
    document.getElementById('backToMainMenu').addEventListener('click', function() {
      document.getElementById('storyMenu').style.display = 'none';
      document.getElementById('startMenu').style.display = 'flex';
    });
    document.getElementById('startButton').addEventListener('click', function() {
      document.getElementById('startMenu').style.display = 'none';
      startGame();
    });
    document.getElementById('storyModeButton').addEventListener('click', function() {
      document.getElementById('startMenu').style.display = 'none';
      currentStoryPage = 0; storyModeActive = true; costMultiplier = 1.5;
      document.getElementById('storyMenu').style.display = 'flex';
      displayStoryPage();
    });
    document.getElementById('resumeButton').addEventListener('click', function() {
      gamePaused = false;
      document.getElementById('pauseMenu').style.display = 'none';
      document.getElementById('backgroundMusic').play();
    });
    document.getElementById('mainMenuButton').addEventListener('click', function() {
      location.reload();
    });
    document.addEventListener('keydown', function(e) {
      if(e.key === 'Escape') togglePause();
      if(e.key === 'd' || e.key === 'D') debugLog();
    });
    function togglePause() {
      gamePaused = !gamePaused;
      document.getElementById('pauseMenu').style.display = gamePaused ? 'flex' : 'none';
      gamePaused 
        ? document.getElementById('backgroundMusic').pause()
        : document.getElementById('backgroundMusic').play();
    }
    function displayPrompt(message) {
      const prompt = document.getElementById('promptDisplay');
      prompt.textContent = message;
      prompt.style.display = 'block';
      setTimeout(() => { prompt.style.display = 'none'; }, 3000);
    }
    function checkPrompts() {
      storyPrompts.forEach(promptObj => {
        if(!promptObj.triggered && promptObj.condition()) {
          promptObj.triggered = true;
          displayPrompt(promptObj.message);
        }
      });
    }
    function startGame() {
      initUpgrades();
      initClickUpgrades();
      document.getElementById('gameContainer').style.display = 'block';
      document.getElementById('backgroundMusic').play();
    }
    function gameLoop() {
      if(!gamePaused) { /* future updates */ }
      requestAnimationFrame(gameLoop);
    }
    requestAnimationFrame(gameLoop);
    function debugLog() {
      console.log("Banana Count:", bananaCount, "Auto Production:", autoProduction, "Click Value:", clickValue, "Upgrades:", upgrades, "Click Upgrades:", clickUpgrades);
    }
    
    /*==============================
      Draggable & Collapsible Windows
    ==============================*/
    function makeDraggable(el) {
      const header = el.querySelector('.window-header');
      let offsetX = 0, offsetY = 0, isDragging = false;
      header.addEventListener('mousedown', (e) => {
        isDragging = true;
        offsetX = e.clientX - el.getBoundingClientRect().left;
        offsetY = e.clientY - el.getBoundingClientRect().top;
      });
      document.addEventListener('mousemove', (e) => {
        if(isDragging) {
          el.style.left = (e.clientX - offsetX) + 'px';
          el.style.top = (e.clientY - offsetY) + 'px';
        }
      });
      document.addEventListener('mouseup', () => { isDragging = false; });
    }
    document.querySelectorAll('.draggable').forEach(makeDraggable);
    document.querySelectorAll('.close-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const panel = document.getElementById(btn.getAttribute('data-target'));
        panel.classList.add('collapsed');
      });
    });
    document.querySelectorAll('.reopen-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const panel = document.getElementById(btn.getAttribute('data-target'));
        panel.classList.remove('collapsed');
      });
    });
  </script>
</body>
</html>
